<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Proof Logic Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-open { color: #22c55e; }
        .status-closed { color: #ef4444; }
        .status-closing { color: #f59e0b; }
        .highlight { background-color: #fef3c7; padding: 2px 4px; border-radius: 4px; }
        .success { background-color: #dcfce7; padding: 10px; border-radius: 4px; border-left: 4px solid #22c55e; }
        .info { background-color: #e0f2fe; padding: 10px; border-radius: 4px; border-left: 4px solid #0ea5e9; }
    </style>
</head>
<body>
    <h1>🧪 Social Proof Logic Test</h1>
    <p><strong>Current Time:</strong> <span id="currentTime"></span></p>
    
    <div class="test-container">
        <h2>📍 Current Restaurant Status</h2>
        <div id="restaurantStatus"></div>
    </div>

    <div class="test-container">
        <h2>👥 Social Proof Behavior Test</h2>
        <div id="socialProofTest"></div>
    </div>

    <div class="test-container">
        <h2>🚚 Delivery Time Test</h2>
        <div id="deliveryTimeTest"></div>
    </div>

    <div class="test-container success">
        <h2>✅ Logic Verification</h2>
        <p>This test verifies that our social proof system:</p>
        <ul>
            <li><strong>Shows 0 ordering count when closed</strong> (no one can order)</li>
            <li><strong>Shows realistic viewing count when closed</strong> (2-5 people browsing)</li>
            <li><strong>Displays appropriate delivery messages</strong> (closed vs open states)</li>
            <li><strong>No urgency messages when inappropriate</strong> (closed or closing soon)</li>
            <li><strong>Realistic recent order times</strong> (hours ago when closed, minutes when open)</li>
        </ul>
    </div>

    <script>
        // Mock the restaurant hours logic for testing
        function getRestaurantStatus() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTimeInMinutes = currentHour * 60 + currentMinute;
            
            const openingTimeInMinutes = 11 * 60 + 0; // 11:00
            const closingTimeInMinutes = 21 * 60 + 30; // 21:30
            
            const isOpen = currentTimeInMinutes >= openingTimeInMinutes && currentTimeInMinutes < closingTimeInMinutes;
            
            let timeUntilClosing = 0;
            let timeUntilOpening = 0;
            let status = 'closed';
            
            if (isOpen) {
                timeUntilClosing = closingTimeInMinutes - currentTimeInMinutes;
                status = timeUntilClosing <= 60 ? 'closing_soon' : 'open';
            } else {
                if (currentTimeInMinutes < openingTimeInMinutes) {
                    timeUntilOpening = openingTimeInMinutes - currentTimeInMinutes;
                } else {
                    timeUntilOpening = (24 * 60) - currentTimeInMinutes + openingTimeInMinutes;
                }
            }
            
            return {
                isOpen,
                timeUntilClosing,
                timeUntilOpening,
                status,
                openingTime: "11:00",
                closingTime: "21:30"
            };
        }

        function getSocialProofData() {
            const restaurantStatus = getRestaurantStatus();
            const isRestaurantOpen = restaurantStatus.isOpen;
            
            // When restaurant is closed, show different social proof
            if (!isRestaurantOpen) {
                return {
                    orderingCount: 0, // Nobody ordering when closed
                    viewingCount: Math.floor(Math.random() * 4) + 2, // 2-5 people viewing
                    rating: (4.7 + Math.random() * 0.2).toFixed(1),
                    reviewCount: 342,
                    recentOrderTime: "vor 2h", // Last order was hours ago
                    urgencyMessage: undefined, // No urgency when closed
                    isRestaurantOpen: false,
                    restaurantStatus,
                };
            }

            // Restaurant is open - generate dynamic social proof
            const baseOrdering = 8;
            const orderingCount = baseOrdering + Math.floor(Math.random() * 7); // 8-15
            const viewingCount = 15 + Math.floor(Math.random() * 20); // 15-35
            const recentMinutes = Math.floor(Math.random() * 15) + 1; // 1-15 minutes ago
            
            let urgencyMessage = undefined;
            if (restaurantStatus.status !== 'closing_soon' && Math.random() < 0.3) {
                urgencyMessage = {
                    key: "High demand today!",
                    count: Math.floor(Math.random() * 3) + 3
                };
            }
            
            return {
                orderingCount,
                viewingCount,
                rating: (4.7 + Math.random() * 0.2).toFixed(1),
                reviewCount: 342,
                recentOrderTime: `vor ${recentMinutes} Min`,
                urgencyMessage,
                isRestaurantOpen: true,
                restaurantStatus,
            };
        }

        function getDynamicDeliveryTime() {
            const restaurantStatus = getRestaurantStatus();
            
            if (!restaurantStatus.isOpen) {
                const hoursUntilOpen = Math.ceil(restaurantStatus.timeUntilOpening / 60);
                return {
                    estimatedMinutes: restaurantStatus.timeUntilOpening + 25,
                    message: `Geschlossen (öffnet in ${hoursUntilOpen}h)`,
                    urgency: 'low',
                };
            }

            const baseTime = 25;
            const variance = Math.floor(Math.random() * 16) - 5;
            const estimatedMinutes = Math.max(15, Math.min(45, baseTime + variance));
            
            let urgency = 'low';
            let message = `ca. ${estimatedMinutes} Min`;
            
            if (restaurantStatus.status === 'closing_soon') {
                const closingHours = Math.floor(restaurantStatus.timeUntilClosing / 60);
                const closingMinutes = restaurantStatus.timeUntilClosing % 60;
                message = `${estimatedMinutes} Min (schließt in ${closingHours}h ${closingMinutes}min)`;
                urgency = 'high';
            }
            
            return {
                estimatedMinutes,
                message,
                urgency,
            };
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('de-DE');
        }

        function runTests() {
            const restaurantStatus = getRestaurantStatus();
            const socialProof = getSocialProofData();
            const deliveryTime = getDynamicDeliveryTime();

            // Restaurant Status Display
            const statusClass = restaurantStatus.isOpen ? 
                (restaurantStatus.status === 'closing_soon' ? 'status-closing' : 'status-open') : 
                'status-closed';
            
            document.getElementById('restaurantStatus').innerHTML = `
                <p><strong>Status:</strong> <span class="${statusClass}">
                    ${restaurantStatus.isOpen ? 
                        (restaurantStatus.status === 'closing_soon' ? '🟡 CLOSING SOON' : '🟢 OPEN') : 
                        '🔴 CLOSED'}
                </span></p>
                <p><strong>Hours:</strong> ${restaurantStatus.openingTime} - ${restaurantStatus.closingTime}</p>
                ${restaurantStatus.isOpen ? 
                    `<p><strong>Closes in:</strong> ${Math.floor(restaurantStatus.timeUntilClosing / 60)}h ${restaurantStatus.timeUntilClosing % 60}min</p>` :
                    `<p><strong>Opens in:</strong> ${Math.floor(restaurantStatus.timeUntilOpening / 60)}h ${restaurantStatus.timeUntilOpening % 60}min</p>`
                }
            `;

            // Social Proof Test
            document.getElementById('socialProofTest').innerHTML = `
                <div class="info">
                    <h3>Current Social Proof Data:</h3>
                    <p><strong>👥 Ordering Count:</strong> <span class="highlight">${socialProof.orderingCount}</span> 
                       ${socialProof.orderingCount === 0 ? '✅ (Correct: 0 when closed)' : ''}</p>
                    <p><strong>👀 Viewing Count:</strong> <span class="highlight">${socialProof.viewingCount}</span></p>
                    <p><strong>⭐ Rating:</strong> ${socialProof.rating}★ (${socialProof.reviewCount}+)</p>
                    <p><strong>📍 Recent Order:</strong> <span class="highlight">${socialProof.recentOrderTime}</span>
                       ${socialProof.recentOrderTime.includes('2h') ? '✅ (Correct: Hours ago when closed)' : ''}</p>
                    <p><strong>🔥 Urgency Message:</strong> ${socialProof.urgencyMessage ? socialProof.urgencyMessage.key : '<span class="highlight">None</span>'}
                       ${!socialProof.urgencyMessage && !restaurantStatus.isOpen ? '✅ (Correct: No urgency when closed)' : ''}</p>
                </div>
                
                <h3>Display Logic Test:</h3>
                <p><strong>Message to show:</strong> 
                    ${socialProof.isRestaurantOpen && socialProof.orderingCount > 0 
                        ? `"${socialProof.orderingCount} Leute bestellen gerade"` 
                        : socialProof.isRestaurantOpen
                            ? `"${socialProof.viewingCount} schauen sich die Speisekarte an"`
                            : `"${socialProof.viewingCount} schauen sich die Speisekarte an" ✅ (Correct for closed state)`
                    }
                </p>
            `;

            // Delivery Time Test
            document.getElementById('deliveryTimeTest').innerHTML = `
                <div class="info">
                    <h3>Current Delivery Time:</h3>
                    <p><strong>Estimated Time:</strong> ${deliveryTime.estimatedMinutes} minutes</p>
                    <p><strong>Message:</strong> <span class="highlight">${deliveryTime.message}</span>
                       ${deliveryTime.message.includes('Geschlossen') ? '✅ (Correct: Shows closed status)' : ''}</p>
                    <p><strong>Urgency Level:</strong> ${deliveryTime.urgency}</p>
                </div>
            `;
        }

        // Initial run
        updateTime();
        runTests();

        // Update every 10 seconds
        setInterval(() => {
            updateTime();
            runTests();
        }, 10000);
    </script>
</body>
</html>
